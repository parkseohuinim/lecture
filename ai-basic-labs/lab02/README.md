# Lab 02: Vector Database (ChromaDB)

## ğŸ¯ í•™ìŠµ ëª©í‘œ

ì„ë² ë”©ê³¼ Vector Databaseì˜ ê°œë…ì„ ì´í•´í•˜ê³ , ChromaDBë¥¼ ì‚¬ìš©í•˜ì—¬ ë²¡í„° ì €ì¥ ë° ìœ ì‚¬ë„ ê²€ìƒ‰ì„ ì‹¤ìŠµí•©ë‹ˆë‹¤.

### í•µì‹¬ í•™ìŠµ ë‚´ìš©

| ê°œë… | ì„¤ëª… |
|------|------|
| **ì„ë² ë”©(Embedding)** | í…ìŠ¤íŠ¸ë¥¼ ìˆ«ì ë²¡í„°ë¡œ ë³€í™˜í•˜ëŠ” ê¸°ìˆ  |
| **Vector DB** | ê³ ì°¨ì› ë²¡í„°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì €ì¥í•˜ê³  ê²€ìƒ‰í•˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ |
| **ìœ ì‚¬ë„ ê²€ìƒ‰** | ë²¡í„° ê°„ ê±°ë¦¬/ìœ ì‚¬ë„ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê´€ë ¨ ë¬¸ì„œ ì°¾ê¸° |
| **ë©”íƒ€ë°ì´í„° í•„í„°ë§** | ë²¡í„° ê²€ìƒ‰ + ì¡°ê±´ í•„í„°ë§ ê²°í•© |

## ğŸ“š ì‹¤ìŠµ í•­ëª©

```
ì‹¤ìŠµ 1: ì„ë² ë”©(Embedding) ì´í•´í•˜ê¸°
        â””â”€ í…ìŠ¤íŠ¸ê°€ ì–´ë–»ê²Œ ë²¡í„°ë¡œ ë³€í™˜ë˜ëŠ”ì§€ ì§ì ‘ í™•ì¸

ì‹¤ìŠµ 2: Vector DB ê¸°ë³¸ ì‘ì—…
        â””â”€ ë¬¸ì„œ ì¶”ê°€(Add) â†’ ê²€ìƒ‰(Query) â†’ ê²°ê³¼ í•´ì„

ì‹¤ìŠµ 3: ê±°ë¦¬ì™€ ìœ ì‚¬ë„ ì´í•´í•˜ê¸°
        â””â”€ L2 ê±°ë¦¬, ì½”ì‚¬ì¸ ìœ ì‚¬ë„ì˜ ì˜ë¯¸ì™€ í•´ì„ ë°©ë²•

ì‹¤ìŠµ 4: ë©”íƒ€ë°ì´í„° í•„í„°ë§
        â””â”€ ì¡°ê±´ë¶€ ê²€ìƒ‰ìœ¼ë¡œ ì •ë°€í•œ ê²°ê³¼ ì–»ê¸°

ì‹¤ìŠµ 5: ì‹¤ì „ ì˜ˆì œ - ë¬¸ì„œ ê´€ë¦¬ ì‹œìŠ¤í…œ
        â””â”€ ì‹¤ì œ ì• í”Œë¦¬ì¼€ì´ì…˜ íŒ¨í„´ ìµíˆê¸°
```

## ğŸš€ ì„¤ì¹˜ ë° ì‹¤í–‰

```bash
# 1. í”„ë¡œì íŠ¸ ë£¨íŠ¸ë¡œ ì´ë™
cd ai-basic-labs

# 2. í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜ (ì•„ì§ ì•ˆí–ˆë‹¤ë©´)
pip install -r requirements.txt

# 3. í™˜ê²½ë³€ìˆ˜ ì„¤ì • (.env íŒŒì¼ ìƒì„±)
echo "OPENAI_API_KEY=your-api-key-here" > .env

# 4. ì‹¤ìŠµ ì‹¤í–‰
cd lab02
python vector_db.py
```

## ğŸ“– í•µì‹¬ ê°œë… ì„¤ëª…

### 1. ì„ë² ë”©(Embedding)ì´ë€?

```
í…ìŠ¤íŠ¸ â†’ ì„ë² ë”© ëª¨ë¸ â†’ ìˆ«ì ë²¡í„°

ì˜ˆì‹œ:
"Python is great" â†’ [0.023, -0.156, 0.089, ..., 0.045]  (1536ì°¨ì›)
"ì½”ë”©ì´ ì¬ë¯¸ìˆì–´" â†’ [0.031, -0.142, 0.095, ..., 0.038]  (1536ì°¨ì›)
```

**í•µì‹¬ ì›ë¦¬:**
- ì˜ë¯¸ê°€ ë¹„ìŠ·í•œ í…ìŠ¤íŠ¸ â†’ ë¹„ìŠ·í•œ ë²¡í„°
- ë²¡í„° ê³µê°„ì—ì„œ ê°€ê¹Œìš´ ìœ„ì¹˜ì— ë°°ì¹˜
- ê±°ë¦¬/ìœ ì‚¬ë„ë¡œ ì˜ë¯¸ì  ìœ ì‚¬ì„± ì¸¡ì • ê°€ëŠ¥

### 2. Vector DB vs ì¼ë°˜ DB

| êµ¬ë¶„ | ì¼ë°˜ DB | Vector DB |
|------|---------|-----------|
| ê²€ìƒ‰ ë°©ì‹ | ì •í™•í•œ ê°’ ë§¤ì¹­ | ìœ ì‚¬ë„ ê¸°ë°˜ |
| ì¿¼ë¦¬ ì˜ˆì‹œ | `WHERE id = 123` | "ê°€ì¥ ë¹„ìŠ·í•œ ë²¡í„° ì°¾ê¸°" |
| ìš©ë„ | ì •í™•í•œ ë°ì´í„° ì¡°íšŒ | ì˜ë¯¸ ê²€ìƒ‰, ì¶”ì²œ ì‹œìŠ¤í…œ |
| ì¸ë±ìŠ¤ | B-tree, Hash | HNSW, IVF ë“± ANN |

### 3. ê±°ë¦¬ vs ìœ ì‚¬ë„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  L2 ê±°ë¦¬ (Euclidean Distance)                          â”‚
â”‚  â€¢ ê°’ ë²”ìœ„: 0 ~ âˆ                                      â”‚
â”‚  â€¢ 0ì— ê°€ê¹Œìš¸ìˆ˜ë¡ = ë” ìœ ì‚¬                            â”‚
â”‚  â€¢ ChromaDB ê¸°ë³¸ ë©”íŠ¸ë¦­                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì½”ì‚¬ì¸ ìœ ì‚¬ë„ (Cosine Similarity)                      â”‚
â”‚  â€¢ ê°’ ë²”ìœ„: -1 ~ 1                                     â”‚
â”‚  â€¢ 1ì— ê°€ê¹Œìš¸ìˆ˜ë¡ = ë” ìœ ì‚¬                            â”‚
â”‚  â€¢ í…ìŠ¤íŠ¸ ê²€ìƒ‰ì—ì„œ ë§ì´ ì‚¬ìš©                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ê±°ë¦¬ â†’ ìœ ì‚¬ë„ ë³€í™˜:
similarity = 1 / (1 + distance)
```

## ğŸ’» ì£¼ìš” ì½”ë“œ ì˜ˆì‹œ

### ì„ë² ë”© ìƒì„±

```python
from vector_db import EmbeddingGenerator

# ì„ë² ë”© ìƒì„±ê¸° ì´ˆê¸°í™”
embedder = EmbeddingGenerator()

# ë‹¨ì¼ í…ìŠ¤íŠ¸ ì„ë² ë”©
embedding = embedder.get_embedding("Hello, world!")
print(f"ë²¡í„° ì°¨ì›: {len(embedding)}")  # 1536

# ë°°ì¹˜ ì„ë² ë”© (íš¨ìœ¨ì )
texts = ["Text 1", "Text 2", "Text 3"]
embeddings = embedder.get_embeddings_batch(texts)
```

### ChromaDB ê¸°ë³¸ ì‚¬ìš©

```python
from vector_db import ChromaDBManager, EmbeddingGenerator

# ì´ˆê¸°í™”
db = ChromaDBManager()
collection = db.create_collection("my_collection", reset=True)
embedder = EmbeddingGenerator()

# ë¬¸ì„œ ì¶”ê°€
documents = ["Document 1", "Document 2", "Document 3"]
embeddings = embedder.get_embeddings_batch(documents)

collection.add(
    documents=documents,
    embeddings=embeddings,
    ids=["doc_0", "doc_1", "doc_2"],
    metadatas=[{"source": "demo"} for _ in documents]
)

# ê²€ìƒ‰
query = "ê²€ìƒ‰í•  í…ìŠ¤íŠ¸"
query_embedding = embedder.get_embedding(query)

results = collection.query(
    query_embeddings=[query_embedding],
    n_results=3
)
```

### ë©”íƒ€ë°ì´í„° í•„í„°ë§

```python
# ë‹¨ì¼ ì¡°ê±´
results = collection.query(
    query_embeddings=[query_embedding],
    n_results=5,
    where={"language": "python"}
)

# ë³µí•© ì¡°ê±´ (AND)
results = collection.query(
    query_embeddings=[query_embedding],
    n_results=5,
    where={
        "$and": [
            {"language": "python"},
            {"level": "beginner"}
        ]
    }
)

# ë¹„êµ ì—°ì‚°ì
results = collection.query(
    query_embeddings=[query_embedding],
    n_results=5,
    where={"year": {"$gte": 2024}}  # 2024ë…„ ì´í›„
)
```

### DocumentManager ì‚¬ìš© (ì‹¤ì „ íŒ¨í„´)

```python
from vector_db import DocumentManager

# ë¬¸ì„œ ê´€ë¦¬ì ì´ˆê¸°í™”
doc_manager = DocumentManager("knowledge_base", reset=True)

# ë¬¸ì„œ ì¶”ê°€
doc_id = doc_manager.add_document(
    text="Pythonì€ ë°°ìš°ê¸° ì‰¬ìš´ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì…ë‹ˆë‹¤.",
    metadata={"topic": "programming", "language": "python"}
)

# ê²€ìƒ‰ (í•„í„°ë§ í¬í•¨)
results = doc_manager.search(
    query="í”„ë¡œê·¸ë˜ë°ì„ ë°°ìš°ê³  ì‹¶ì–´ìš”",
    n_results=5,
    where={"topic": "programming"}
)

for result in results:
    print(f"[{result.rank}] {result.content}")
    print(f"    ìœ ì‚¬ë„: {result.similarity:.4f}")
```

## ğŸ“Š í•„í„° ì—°ì‚°ì ë ˆí¼ëŸ°ìŠ¤

| ì—°ì‚°ì | ì˜ë¯¸ | ì˜ˆì‹œ |
|--------|------|------|
| `$eq` | ê°™ìŒ | `{"field": "value"}` ë˜ëŠ” `{"field": {"$eq": "value"}}` |
| `$ne` | ê°™ì§€ ì•ŠìŒ | `{"field": {"$ne": "value"}}` |
| `$gt` | í¬ë‹¤ | `{"field": {"$gt": 10}}` |
| `$gte` | í¬ê±°ë‚˜ ê°™ë‹¤ | `{"field": {"$gte": 10}}` |
| `$lt` | ì‘ë‹¤ | `{"field": {"$lt": 10}}` |
| `$lte` | ì‘ê±°ë‚˜ ê°™ë‹¤ | `{"field": {"$lte": 10}}` |
| `$in` | í¬í•¨ | `{"field": {"$in": ["a", "b"]}}` |
| `$and` | ëª¨ë‘ ë§Œì¡± | `{"$and": [ì¡°ê±´1, ì¡°ê±´2]}` |
| `$or` | í•˜ë‚˜ë§Œ ë§Œì¡± | `{"$or": [ì¡°ê±´1, ì¡°ê±´2]}` |

## ğŸ”„ Vector DB ë¹„êµ

| íŠ¹ì§• | ChromaDB | Pinecone | Qdrant | Milvus |
|------|----------|----------|--------|--------|
| ì„¤ì¹˜ | `pip install` | í´ë¼ìš°ë“œ | Docker | Docker |
| ë¡œì»¬ ì‚¬ìš© | âœ… ë§¤ìš° ì‰¬ì›€ | âŒ ë¶ˆê°€ | âœ… ê°€ëŠ¥ | âœ… ê°€ëŠ¥ |
| ê·œëª¨ | ì†Œ~ì¤‘ê·œëª¨ | ëŒ€ê·œëª¨ | ëŒ€ê·œëª¨ | ëŒ€ê·œëª¨ |
| ë¹„ìš© | ë¬´ë£Œ | ìœ ë£Œ | ë¬´ë£Œ (ì…€í”„) | ë¬´ë£Œ (ì…€í”„) |
| í•™ìŠµ ë‚œì´ë„ | ì‰¬ì›€ | ë³´í†µ | ë³´í†µ | ì–´ë ¤ì›€ |

## ğŸ“ ìƒì„±ë˜ëŠ” íŒŒì¼

```
lab02/
â”œâ”€â”€ vector_db.py        # ì‹¤ìŠµ ì½”ë“œ
â”œâ”€â”€ README.md           # ì´ íŒŒì¼
â””â”€â”€ chroma_db/          # ChromaDB ë°ì´í„° ì €ì¥ì†Œ (ìë™ ìƒì„±)
    â”œâ”€â”€ chroma.sqlite3  # ë©”íƒ€ë°ì´í„° ì €ì¥
    â””â”€â”€ ...             # ë²¡í„° ë°ì´í„°
```

**ì£¼ì˜**: `chroma_db/` ë””ë ‰í† ë¦¬ë¥¼ ì‚­ì œí•˜ë©´ ëª¨ë“  ë²¡í„° ë°ì´í„°ê°€ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.

## ğŸ’¡ í•™ìŠµ í¬ì¸íŠ¸ ìš”ì•½

### 1. ì„ë² ë”©ì˜ í•µì‹¬
- í…ìŠ¤íŠ¸ â†’ ê³ ì • ê¸¸ì´ ìˆ«ì ë²¡í„° (ì˜ˆ: 1536ì°¨ì›)
- ì˜ë¯¸ê°€ ë¹„ìŠ·í•˜ë©´ ë²¡í„°ë„ ë¹„ìŠ·
- OpenAI `text-embedding-3-small`: ì„±ëŠ¥ê³¼ ë¹„ìš©ì˜ ê· í˜•

### 2. Vector DBì˜ ì—­í• 
- ê³ ì°¨ì› ë²¡í„°ì˜ íš¨ìœ¨ì ì¸ ì €ì¥
- ë¹ ë¥¸ ìœ ì‚¬ë„ ê²€ìƒ‰ (ANN - Approximate Nearest Neighbor)
- ë©”íƒ€ë°ì´í„°ì™€ í•¨ê»˜ ê´€ë¦¬

### 3. ê±°ë¦¬/ìœ ì‚¬ë„ í•´ì„
- L2 ê±°ë¦¬: ì‘ì„ìˆ˜ë¡ ìœ ì‚¬ (0ì´ ê°€ì¥ ê°€ê¹Œì›€)
- ìœ ì‚¬ë„: í´ìˆ˜ë¡ ìœ ì‚¬ (1ì´ ê°€ì¥ ë¹„ìŠ·)
- ì ìˆ˜ í•´ì„ì€ ìƒëŒ€ì ìœ¼ë¡œ íŒë‹¨

### 4. ë©”íƒ€ë°ì´í„° í™œìš©
- ì˜ë¯¸ ê²€ìƒ‰ + ì¡°ê±´ í•„í„°ë§ ê²°í•©
- ì‹¤ë¬´: ë‚ ì§œ, ì¹´í…Œê³ ë¦¬, ê¶Œí•œ ë“± í•„í„°ë§
- ì˜ ì„¤ê³„ëœ ë©”íƒ€ë°ì´í„° = ìœ ì—°í•œ ê²€ìƒ‰

## â¡ï¸ ë‹¤ìŒ ë‹¨ê³„

- **Lab 03**: RAG (Retrieval-Augmented Generation) ì‹œìŠ¤í…œ êµ¬ì¶•
  - Vector DBë¥¼ í™œìš©í•œ ë¬¸ì„œ ê²€ìƒ‰
  - ê²€ìƒ‰ëœ ë¬¸ì„œë¡œ LLM ë‹µë³€ ìƒì„±
  - ì²­í‚¹, ì»¨í…ìŠ¤íŠ¸ ê´€ë¦¬, ê³ ê¸‰ RAG ê¸°ë²•

## ğŸ“š ì°¸ê³  ìë£Œ

- [ChromaDB Documentation](https://docs.trychroma.com/)
- [OpenAI Embeddings Guide](https://platform.openai.com/docs/guides/embeddings)
- [Vector Database ê°œë…](https://www.pinecone.io/learn/vector-database/)
- [Understanding Embeddings](https://towardsdatascience.com/getting-started-with-embeddings-a8f97bdf5a71)
